# Rules: 7435-7455

## insider-threat-detection-queries (15)

Intent:
- Use MTP capability to look for insider threat potential risk indicators
- Indicators would then serve as the building block for insider threat risk modeling in subsequent tools
Definition of Insider Threat:
"The potential for an individual who has or had authorized access to an organization's assets to use their access, either maliciously or unintentionally, to act in a way that could negatively affect the organization."
This collection of queries describes the different indicators that could be used to model and look for patterns suggesting an increased risk of an individual becoming a potential insider threat.
Note: no single indicator should be used as a lone determinant of insider threat activity, but should be part of an overall program to understand the increased risk to your organization's critical assets. This in turn is used to feed an investigation by a formal insider threat program to look at the context associated with the whole person to understand the implication of a set of indicators.

|Name | Value |
| --- | --- |
|Tactic | Initial access|
|TechniqueId | |
|Platform | Windows|
|DetectionType | Hunting |
|ConnectorId | MicrosoftThreatProtection |
|DetectionId | 659e686d-850e-4240-a339-b24928f95e90 |
|DataTypes | DeviceLogonEvents |
|QueryFrequency |  |
|QueryPeriod |  |
|TriggerOperator |  |
|TriggerThreshold |  |
|DetectionSeverity |  |
|DetectionUrl | https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/General%20queries/insider-threat-detection-queries%20(15).yaml |
|IngestedDate | 2022-08-07 |

### KQL
```kql
// --------------------------------------------------------------------------------------------------------------------------- //
//
//After-Hours Login
//
//Change the StartTime and EndTime to reflect typical working hours
//This query needs some adjustments, as the default for a datetime object with no date is to only query "today"
let StartTime = datetime("8:00:00 AM");
let EndTime = datetime("5:00:00 PM");
DeviceLogonEvents
| where InitiatingProcessAccountName != "system"
| where Timestamp between ((EndTime) .. StartTime)

```

## insider-threat-detection-queries (15)

Intent:
- Use MTP capability to look for insider threat potential risk indicators
- Indicators would then serve as the building block for insider threat risk modeling in subsequent tools
Definition of Insider Threat:
"The potential for an individual who has or had authorized access to an organization's assets to use their access, either maliciously or unintentionally, to act in a way that could negatively affect the organization."
This collection of queries describes the different indicators that could be used to model and look for patterns suggesting an increased risk of an individual becoming a potential insider threat.
Note: no single indicator should be used as a lone determinant of insider threat activity, but should be part of an overall program to understand the increased risk to your organization's critical assets. This in turn is used to feed an investigation by a formal insider threat program to look at the context associated with the whole person to understand the implication of a set of indicators.

|Name | Value |
| --- | --- |
|Tactic | Persistence|
|TechniqueId | |
|Platform | Azure|
|DetectionType | Hunting |
|ConnectorId | MicrosoftThreatProtection |
|DetectionId | 659e686d-850e-4240-a339-b24928f95e90 |
|DataTypes | DeviceLogonEvents |
|QueryFrequency |  |
|QueryPeriod |  |
|TriggerOperator |  |
|TriggerThreshold |  |
|DetectionSeverity |  |
|DetectionUrl | https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/General%20queries/insider-threat-detection-queries%20(15).yaml |
|IngestedDate | 2022-08-07 |

### KQL
```kql
// --------------------------------------------------------------------------------------------------------------------------- //
//
//After-Hours Login
//
//Change the StartTime and EndTime to reflect typical working hours
//This query needs some adjustments, as the default for a datetime object with no date is to only query "today"
let StartTime = datetime("8:00:00 AM");
let EndTime = datetime("5:00:00 PM");
DeviceLogonEvents
| where InitiatingProcessAccountName != "system"
| where Timestamp between ((EndTime) .. StartTime)

```

## insider-threat-detection-queries (15)

Intent:
- Use MTP capability to look for insider threat potential risk indicators
- Indicators would then serve as the building block for insider threat risk modeling in subsequent tools
Definition of Insider Threat:
"The potential for an individual who has or had authorized access to an organization's assets to use their access, either maliciously or unintentionally, to act in a way that could negatively affect the organization."
This collection of queries describes the different indicators that could be used to model and look for patterns suggesting an increased risk of an individual becoming a potential insider threat.
Note: no single indicator should be used as a lone determinant of insider threat activity, but should be part of an overall program to understand the increased risk to your organization's critical assets. This in turn is used to feed an investigation by a formal insider threat program to look at the context associated with the whole person to understand the implication of a set of indicators.

|Name | Value |
| --- | --- |
|Tactic | Persistence|
|TechniqueId | |
|Platform | Windows|
|DetectionType | Hunting |
|ConnectorId | MicrosoftThreatProtection |
|DetectionId | 659e686d-850e-4240-a339-b24928f95e90 |
|DataTypes | DeviceLogonEvents |
|QueryFrequency |  |
|QueryPeriod |  |
|TriggerOperator |  |
|TriggerThreshold |  |
|DetectionSeverity |  |
|DetectionUrl | https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/General%20queries/insider-threat-detection-queries%20(15).yaml |
|IngestedDate | 2022-08-07 |

### KQL
```kql
// --------------------------------------------------------------------------------------------------------------------------- //
//
//After-Hours Login
//
//Change the StartTime and EndTime to reflect typical working hours
//This query needs some adjustments, as the default for a datetime object with no date is to only query "today"
let StartTime = datetime("8:00:00 AM");
let EndTime = datetime("5:00:00 PM");
DeviceLogonEvents
| where InitiatingProcessAccountName != "system"
| where Timestamp between ((EndTime) .. StartTime)

```

## insider-threat-detection-queries (15)

Intent:
- Use MTP capability to look for insider threat potential risk indicators
- Indicators would then serve as the building block for insider threat risk modeling in subsequent tools
Definition of Insider Threat:
"The potential for an individual who has or had authorized access to an organization's assets to use their access, either maliciously or unintentionally, to act in a way that could negatively affect the organization."
This collection of queries describes the different indicators that could be used to model and look for patterns suggesting an increased risk of an individual becoming a potential insider threat.
Note: no single indicator should be used as a lone determinant of insider threat activity, but should be part of an overall program to understand the increased risk to your organization's critical assets. This in turn is used to feed an investigation by a formal insider threat program to look at the context associated with the whole person to understand the implication of a set of indicators.

|Name | Value |
| --- | --- |
|Tactic | Exfiltration|
|TechniqueId | |
|Platform | Azure|
|DetectionType | Hunting |
|ConnectorId | MicrosoftThreatProtection |
|DetectionId | 659e686d-850e-4240-a339-b24928f95e90 |
|DataTypes | DeviceLogonEvents |
|QueryFrequency |  |
|QueryPeriod |  |
|TriggerOperator |  |
|TriggerThreshold |  |
|DetectionSeverity |  |
|DetectionUrl | https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/General%20queries/insider-threat-detection-queries%20(15).yaml |
|IngestedDate | 2022-08-07 |

### KQL
```kql
// --------------------------------------------------------------------------------------------------------------------------- //
//
//After-Hours Login
//
//Change the StartTime and EndTime to reflect typical working hours
//This query needs some adjustments, as the default for a datetime object with no date is to only query "today"
let StartTime = datetime("8:00:00 AM");
let EndTime = datetime("5:00:00 PM");
DeviceLogonEvents
| where InitiatingProcessAccountName != "system"
| where Timestamp between ((EndTime) .. StartTime)

```

## insider-threat-detection-queries (15)

Intent:
- Use MTP capability to look for insider threat potential risk indicators
- Indicators would then serve as the building block for insider threat risk modeling in subsequent tools
Definition of Insider Threat:
"The potential for an individual who has or had authorized access to an organization's assets to use their access, either maliciously or unintentionally, to act in a way that could negatively affect the organization."
This collection of queries describes the different indicators that could be used to model and look for patterns suggesting an increased risk of an individual becoming a potential insider threat.
Note: no single indicator should be used as a lone determinant of insider threat activity, but should be part of an overall program to understand the increased risk to your organization's critical assets. This in turn is used to feed an investigation by a formal insider threat program to look at the context associated with the whole person to understand the implication of a set of indicators.

|Name | Value |
| --- | --- |
|Tactic | Exfiltration|
|TechniqueId | |
|Platform | Windows|
|DetectionType | Hunting |
|ConnectorId | MicrosoftThreatProtection |
|DetectionId | 659e686d-850e-4240-a339-b24928f95e90 |
|DataTypes | DeviceLogonEvents |
|QueryFrequency |  |
|QueryPeriod |  |
|TriggerOperator |  |
|TriggerThreshold |  |
|DetectionSeverity |  |
|DetectionUrl | https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/General%20queries/insider-threat-detection-queries%20(15).yaml |
|IngestedDate | 2022-08-07 |

### KQL
```kql
// --------------------------------------------------------------------------------------------------------------------------- //
//
//After-Hours Login
//
//Change the StartTime and EndTime to reflect typical working hours
//This query needs some adjustments, as the default for a datetime object with no date is to only query "today"
let StartTime = datetime("8:00:00 AM");
let EndTime = datetime("5:00:00 PM");
DeviceLogonEvents
| where InitiatingProcessAccountName != "system"
| where Timestamp between ((EndTime) .. StartTime)

```

## insider-threat-detection-queries (17)

Intent:
- Use MTP capability to look for insider threat potential risk indicators
- Indicators would then serve as the building block for insider threat risk modeling in subsequent tools
Definition of Insider Threat:
"The potential for an individual who has or had authorized access to an organization's assets to use their access, either maliciously or unintentionally, to act in a way that could negatively affect the organization."
This collection of queries describes the different indicators that could be used to model and look for patterns suggesting an increased risk of an individual becoming a potential insider threat.
Note: no single indicator should be used as a lone determinant of insider threat activity, but should be part of an overall program to understand the increased risk to your organization's critical assets. This in turn is used to feed an investigation by a formal insider threat program to look at the context associated with the whole person to understand the implication of a set of indicators.

|Name | Value |
| --- | --- |
|Tactic | Initial access|
|TechniqueId | |
|Platform | Azure|
|DetectionType | Hunting |
|ConnectorId | MicrosoftThreatProtection |
|DetectionId | b2ef671b-57c1-4660-9247-9e88e5e0a16d |
|DataTypes | DeviceLogonEvents |
|QueryFrequency |  |
|QueryPeriod |  |
|TriggerOperator |  |
|TriggerThreshold |  |
|DetectionSeverity |  |
|DetectionUrl | https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/General%20queries/insider-threat-detection-queries%20(17).yaml |
|IngestedDate | 2022-08-07 |

### KQL
```kql
// --------------------------------------------------------------------------------------------------------------------------- //
//
//Service Account Use
//
let ServiceAccountPrefix = pack_array(       // Declare Account Prefix to identify Service Accounts
    '_',
    'svc',
    'service'
);
let InteractiveTypes = pack_array(           // Declare Interactive logon type names
    'Interactive',
    'CachedInteractive',
    'Unlock',
    'RemoteInteractive',
    'CachedRemoteInteractive',
    'CachedUnlock'
);
let WhitelistedAccounts = pack_array(
      'WhitelistAccount1',
      'WhitelistAccount2'
);                                              // List of accounts that match criteria but are able to logon interactively
DeviceLogonEvents                               // Get all logon events...
| where AccountName !in~ (WhitelistedAccounts)  // ...where it is not a whitelisted account...
| where ActionType == "LogonSuccess"            // ...and the logon was successful...
| where AccountName !contains "$"               // ...and not a machine logon. . .
| where AccountName startswith ServiceAccountPrefix                // ...and not a machine logon. . .
| where LogonType in (InteractiveTypes)         // Determine if the logon is interactive (True=1,False=0)...

```

## insider-threat-detection-queries (17)

Intent:
- Use MTP capability to look for insider threat potential risk indicators
- Indicators would then serve as the building block for insider threat risk modeling in subsequent tools
Definition of Insider Threat:
"The potential for an individual who has or had authorized access to an organization's assets to use their access, either maliciously or unintentionally, to act in a way that could negatively affect the organization."
This collection of queries describes the different indicators that could be used to model and look for patterns suggesting an increased risk of an individual becoming a potential insider threat.
Note: no single indicator should be used as a lone determinant of insider threat activity, but should be part of an overall program to understand the increased risk to your organization's critical assets. This in turn is used to feed an investigation by a formal insider threat program to look at the context associated with the whole person to understand the implication of a set of indicators.

|Name | Value |
| --- | --- |
|Tactic | Initial access|
|TechniqueId | |
|Platform | Windows|
|DetectionType | Hunting |
|ConnectorId | MicrosoftThreatProtection |
|DetectionId | b2ef671b-57c1-4660-9247-9e88e5e0a16d |
|DataTypes | DeviceLogonEvents |
|QueryFrequency |  |
|QueryPeriod |  |
|TriggerOperator |  |
|TriggerThreshold |  |
|DetectionSeverity |  |
|DetectionUrl | https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/General%20queries/insider-threat-detection-queries%20(17).yaml |
|IngestedDate | 2022-08-07 |

### KQL
```kql
// --------------------------------------------------------------------------------------------------------------------------- //
//
//Service Account Use
//
let ServiceAccountPrefix = pack_array(       // Declare Account Prefix to identify Service Accounts
    '_',
    'svc',
    'service'
);
let InteractiveTypes = pack_array(           // Declare Interactive logon type names
    'Interactive',
    'CachedInteractive',
    'Unlock',
    'RemoteInteractive',
    'CachedRemoteInteractive',
    'CachedUnlock'
);
let WhitelistedAccounts = pack_array(
      'WhitelistAccount1',
      'WhitelistAccount2'
);                                              // List of accounts that match criteria but are able to logon interactively
DeviceLogonEvents                               // Get all logon events...
| where AccountName !in~ (WhitelistedAccounts)  // ...where it is not a whitelisted account...
| where ActionType == "LogonSuccess"            // ...and the logon was successful...
| where AccountName !contains "$"               // ...and not a machine logon. . .
| where AccountName startswith ServiceAccountPrefix                // ...and not a machine logon. . .
| where LogonType in (InteractiveTypes)         // Determine if the logon is interactive (True=1,False=0)...

```

## insider-threat-detection-queries (17)

Intent:
- Use MTP capability to look for insider threat potential risk indicators
- Indicators would then serve as the building block for insider threat risk modeling in subsequent tools
Definition of Insider Threat:
"The potential for an individual who has or had authorized access to an organization's assets to use their access, either maliciously or unintentionally, to act in a way that could negatively affect the organization."
This collection of queries describes the different indicators that could be used to model and look for patterns suggesting an increased risk of an individual becoming a potential insider threat.
Note: no single indicator should be used as a lone determinant of insider threat activity, but should be part of an overall program to understand the increased risk to your organization's critical assets. This in turn is used to feed an investigation by a formal insider threat program to look at the context associated with the whole person to understand the implication of a set of indicators.

|Name | Value |
| --- | --- |
|Tactic | Persistence|
|TechniqueId | |
|Platform | Azure|
|DetectionType | Hunting |
|ConnectorId | MicrosoftThreatProtection |
|DetectionId | b2ef671b-57c1-4660-9247-9e88e5e0a16d |
|DataTypes | DeviceLogonEvents |
|QueryFrequency |  |
|QueryPeriod |  |
|TriggerOperator |  |
|TriggerThreshold |  |
|DetectionSeverity |  |
|DetectionUrl | https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/General%20queries/insider-threat-detection-queries%20(17).yaml |
|IngestedDate | 2022-08-07 |

### KQL
```kql
// --------------------------------------------------------------------------------------------------------------------------- //
//
//Service Account Use
//
let ServiceAccountPrefix = pack_array(       // Declare Account Prefix to identify Service Accounts
    '_',
    'svc',
    'service'
);
let InteractiveTypes = pack_array(           // Declare Interactive logon type names
    'Interactive',
    'CachedInteractive',
    'Unlock',
    'RemoteInteractive',
    'CachedRemoteInteractive',
    'CachedUnlock'
);
let WhitelistedAccounts = pack_array(
      'WhitelistAccount1',
      'WhitelistAccount2'
);                                              // List of accounts that match criteria but are able to logon interactively
DeviceLogonEvents                               // Get all logon events...
| where AccountName !in~ (WhitelistedAccounts)  // ...where it is not a whitelisted account...
| where ActionType == "LogonSuccess"            // ...and the logon was successful...
| where AccountName !contains "$"               // ...and not a machine logon. . .
| where AccountName startswith ServiceAccountPrefix                // ...and not a machine logon. . .
| where LogonType in (InteractiveTypes)         // Determine if the logon is interactive (True=1,False=0)...

```

## insider-threat-detection-queries (17)

Intent:
- Use MTP capability to look for insider threat potential risk indicators
- Indicators would then serve as the building block for insider threat risk modeling in subsequent tools
Definition of Insider Threat:
"The potential for an individual who has or had authorized access to an organization's assets to use their access, either maliciously or unintentionally, to act in a way that could negatively affect the organization."
This collection of queries describes the different indicators that could be used to model and look for patterns suggesting an increased risk of an individual becoming a potential insider threat.
Note: no single indicator should be used as a lone determinant of insider threat activity, but should be part of an overall program to understand the increased risk to your organization's critical assets. This in turn is used to feed an investigation by a formal insider threat program to look at the context associated with the whole person to understand the implication of a set of indicators.

|Name | Value |
| --- | --- |
|Tactic | Persistence|
|TechniqueId | |
|Platform | Windows|
|DetectionType | Hunting |
|ConnectorId | MicrosoftThreatProtection |
|DetectionId | b2ef671b-57c1-4660-9247-9e88e5e0a16d |
|DataTypes | DeviceLogonEvents |
|QueryFrequency |  |
|QueryPeriod |  |
|TriggerOperator |  |
|TriggerThreshold |  |
|DetectionSeverity |  |
|DetectionUrl | https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/General%20queries/insider-threat-detection-queries%20(17).yaml |
|IngestedDate | 2022-08-07 |

### KQL
```kql
// --------------------------------------------------------------------------------------------------------------------------- //
//
//Service Account Use
//
let ServiceAccountPrefix = pack_array(       // Declare Account Prefix to identify Service Accounts
    '_',
    'svc',
    'service'
);
let InteractiveTypes = pack_array(           // Declare Interactive logon type names
    'Interactive',
    'CachedInteractive',
    'Unlock',
    'RemoteInteractive',
    'CachedRemoteInteractive',
    'CachedUnlock'
);
let WhitelistedAccounts = pack_array(
      'WhitelistAccount1',
      'WhitelistAccount2'
);                                              // List of accounts that match criteria but are able to logon interactively
DeviceLogonEvents                               // Get all logon events...
| where AccountName !in~ (WhitelistedAccounts)  // ...where it is not a whitelisted account...
| where ActionType == "LogonSuccess"            // ...and the logon was successful...
| where AccountName !contains "$"               // ...and not a machine logon. . .
| where AccountName startswith ServiceAccountPrefix                // ...and not a machine logon. . .
| where LogonType in (InteractiveTypes)         // Determine if the logon is interactive (True=1,False=0)...

```

## insider-threat-detection-queries (17)

Intent:
- Use MTP capability to look for insider threat potential risk indicators
- Indicators would then serve as the building block for insider threat risk modeling in subsequent tools
Definition of Insider Threat:
"The potential for an individual who has or had authorized access to an organization's assets to use their access, either maliciously or unintentionally, to act in a way that could negatively affect the organization."
This collection of queries describes the different indicators that could be used to model and look for patterns suggesting an increased risk of an individual becoming a potential insider threat.
Note: no single indicator should be used as a lone determinant of insider threat activity, but should be part of an overall program to understand the increased risk to your organization's critical assets. This in turn is used to feed an investigation by a formal insider threat program to look at the context associated with the whole person to understand the implication of a set of indicators.

|Name | Value |
| --- | --- |
|Tactic | Exfiltration|
|TechniqueId | |
|Platform | Azure|
|DetectionType | Hunting |
|ConnectorId | MicrosoftThreatProtection |
|DetectionId | b2ef671b-57c1-4660-9247-9e88e5e0a16d |
|DataTypes | DeviceLogonEvents |
|QueryFrequency |  |
|QueryPeriod |  |
|TriggerOperator |  |
|TriggerThreshold |  |
|DetectionSeverity |  |
|DetectionUrl | https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/General%20queries/insider-threat-detection-queries%20(17).yaml |
|IngestedDate | 2022-08-07 |

### KQL
```kql
// --------------------------------------------------------------------------------------------------------------------------- //
//
//Service Account Use
//
let ServiceAccountPrefix = pack_array(       // Declare Account Prefix to identify Service Accounts
    '_',
    'svc',
    'service'
);
let InteractiveTypes = pack_array(           // Declare Interactive logon type names
    'Interactive',
    'CachedInteractive',
    'Unlock',
    'RemoteInteractive',
    'CachedRemoteInteractive',
    'CachedUnlock'
);
let WhitelistedAccounts = pack_array(
      'WhitelistAccount1',
      'WhitelistAccount2'
);                                              // List of accounts that match criteria but are able to logon interactively
DeviceLogonEvents                               // Get all logon events...
| where AccountName !in~ (WhitelistedAccounts)  // ...where it is not a whitelisted account...
| where ActionType == "LogonSuccess"            // ...and the logon was successful...
| where AccountName !contains "$"               // ...and not a machine logon. . .
| where AccountName startswith ServiceAccountPrefix                // ...and not a machine logon. . .
| where LogonType in (InteractiveTypes)         // Determine if the logon is interactive (True=1,False=0)...

```

## insider-threat-detection-queries (17)

Intent:
- Use MTP capability to look for insider threat potential risk indicators
- Indicators would then serve as the building block for insider threat risk modeling in subsequent tools
Definition of Insider Threat:
"The potential for an individual who has or had authorized access to an organization's assets to use their access, either maliciously or unintentionally, to act in a way that could negatively affect the organization."
This collection of queries describes the different indicators that could be used to model and look for patterns suggesting an increased risk of an individual becoming a potential insider threat.
Note: no single indicator should be used as a lone determinant of insider threat activity, but should be part of an overall program to understand the increased risk to your organization's critical assets. This in turn is used to feed an investigation by a formal insider threat program to look at the context associated with the whole person to understand the implication of a set of indicators.

|Name | Value |
| --- | --- |
|Tactic | Exfiltration|
|TechniqueId | |
|Platform | Windows|
|DetectionType | Hunting |
|ConnectorId | MicrosoftThreatProtection |
|DetectionId | b2ef671b-57c1-4660-9247-9e88e5e0a16d |
|DataTypes | DeviceLogonEvents |
|QueryFrequency |  |
|QueryPeriod |  |
|TriggerOperator |  |
|TriggerThreshold |  |
|DetectionSeverity |  |
|DetectionUrl | https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/General%20queries/insider-threat-detection-queries%20(17).yaml |
|IngestedDate | 2022-08-07 |

### KQL
```kql
// --------------------------------------------------------------------------------------------------------------------------- //
//
//Service Account Use
//
let ServiceAccountPrefix = pack_array(       // Declare Account Prefix to identify Service Accounts
    '_',
    'svc',
    'service'
);
let InteractiveTypes = pack_array(           // Declare Interactive logon type names
    'Interactive',
    'CachedInteractive',
    'Unlock',
    'RemoteInteractive',
    'CachedRemoteInteractive',
    'CachedUnlock'
);
let WhitelistedAccounts = pack_array(
      'WhitelistAccount1',
      'WhitelistAccount2'
);                                              // List of accounts that match criteria but are able to logon interactively
DeviceLogonEvents                               // Get all logon events...
| where AccountName !in~ (WhitelistedAccounts)  // ...where it is not a whitelisted account...
| where ActionType == "LogonSuccess"            // ...and the logon was successful...
| where AccountName !contains "$"               // ...and not a machine logon. . .
| where AccountName startswith ServiceAccountPrefix                // ...and not a machine logon. . .
| where LogonType in (InteractiveTypes)         // Determine if the logon is interactive (True=1,False=0)...

```

## insider-threat-detection-queries

Intent:
- Use MTP capability to look for insider threat potential risk indicators
- Indicators would then serve as the building block for insider threat risk modeling in subsequent tools
Definition of Insider Threat:
"The potential for an individual who has or had authorized access to an organization's assets to use their access, either maliciously or unintentionally, to act in a way that could negatively affect the organization."
This collection of queries describes the different indicators that could be used to model and look for patterns suggesting an increased risk of an individual becoming a potential insider threat.
Note: no single indicator should be used as a lone determinant of insider threat activity, but should be part of an overall program to understand the increased risk to your organization's critical assets. This in turn is used to feed an investigation by a formal insider threat program to look at the context associated with the whole person to understand the implication of a set of indicators.

|Name | Value |
| --- | --- |
|Tactic | Initial access|
|TechniqueId | |
|Platform | Azure|
|DetectionType | Hunting |
|ConnectorId | MicrosoftThreatProtection |
|DetectionId | d69ccf9a-4592-41db-a78f-f24108fea06e |
|DataTypes | DeviceLogonEvents |
|QueryFrequency |  |
|QueryPeriod |  |
|TriggerOperator |  |
|TriggerThreshold |  |
|DetectionSeverity |  |
|DetectionUrl | https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/General%20queries/insider-threat-detection-queries.yaml |
|IngestedDate | 2022-08-07 |

### KQL
```kql
// --------------------------------------------------------------------------------------------------------------------------- //
//
//Local Administrator
//
DeviceLogonEvents
| where IsLocalAdmin ==0
| where InitiatingProcessAccountName != "system"

```

## insider-threat-detection-queries

Intent:
- Use MTP capability to look for insider threat potential risk indicators
- Indicators would then serve as the building block for insider threat risk modeling in subsequent tools
Definition of Insider Threat:
"The potential for an individual who has or had authorized access to an organization's assets to use their access, either maliciously or unintentionally, to act in a way that could negatively affect the organization."
This collection of queries describes the different indicators that could be used to model and look for patterns suggesting an increased risk of an individual becoming a potential insider threat.
Note: no single indicator should be used as a lone determinant of insider threat activity, but should be part of an overall program to understand the increased risk to your organization's critical assets. This in turn is used to feed an investigation by a formal insider threat program to look at the context associated with the whole person to understand the implication of a set of indicators.

|Name | Value |
| --- | --- |
|Tactic | Initial access|
|TechniqueId | |
|Platform | Windows|
|DetectionType | Hunting |
|ConnectorId | MicrosoftThreatProtection |
|DetectionId | d69ccf9a-4592-41db-a78f-f24108fea06e |
|DataTypes | DeviceLogonEvents |
|QueryFrequency |  |
|QueryPeriod |  |
|TriggerOperator |  |
|TriggerThreshold |  |
|DetectionSeverity |  |
|DetectionUrl | https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/General%20queries/insider-threat-detection-queries.yaml |
|IngestedDate | 2022-08-07 |

### KQL
```kql
// --------------------------------------------------------------------------------------------------------------------------- //
//
//Local Administrator
//
DeviceLogonEvents
| where IsLocalAdmin ==0
| where InitiatingProcessAccountName != "system"

```

## insider-threat-detection-queries

Intent:
- Use MTP capability to look for insider threat potential risk indicators
- Indicators would then serve as the building block for insider threat risk modeling in subsequent tools
Definition of Insider Threat:
"The potential for an individual who has or had authorized access to an organization's assets to use their access, either maliciously or unintentionally, to act in a way that could negatively affect the organization."
This collection of queries describes the different indicators that could be used to model and look for patterns suggesting an increased risk of an individual becoming a potential insider threat.
Note: no single indicator should be used as a lone determinant of insider threat activity, but should be part of an overall program to understand the increased risk to your organization's critical assets. This in turn is used to feed an investigation by a formal insider threat program to look at the context associated with the whole person to understand the implication of a set of indicators.

|Name | Value |
| --- | --- |
|Tactic | Persistence|
|TechniqueId | |
|Platform | Azure|
|DetectionType | Hunting |
|ConnectorId | MicrosoftThreatProtection |
|DetectionId | d69ccf9a-4592-41db-a78f-f24108fea06e |
|DataTypes | DeviceLogonEvents |
|QueryFrequency |  |
|QueryPeriod |  |
|TriggerOperator |  |
|TriggerThreshold |  |
|DetectionSeverity |  |
|DetectionUrl | https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/General%20queries/insider-threat-detection-queries.yaml |
|IngestedDate | 2022-08-07 |

### KQL
```kql
// --------------------------------------------------------------------------------------------------------------------------- //
//
//Local Administrator
//
DeviceLogonEvents
| where IsLocalAdmin ==0
| where InitiatingProcessAccountName != "system"

```

## insider-threat-detection-queries

Intent:
- Use MTP capability to look for insider threat potential risk indicators
- Indicators would then serve as the building block for insider threat risk modeling in subsequent tools
Definition of Insider Threat:
"The potential for an individual who has or had authorized access to an organization's assets to use their access, either maliciously or unintentionally, to act in a way that could negatively affect the organization."
This collection of queries describes the different indicators that could be used to model and look for patterns suggesting an increased risk of an individual becoming a potential insider threat.
Note: no single indicator should be used as a lone determinant of insider threat activity, but should be part of an overall program to understand the increased risk to your organization's critical assets. This in turn is used to feed an investigation by a formal insider threat program to look at the context associated with the whole person to understand the implication of a set of indicators.

|Name | Value |
| --- | --- |
|Tactic | Persistence|
|TechniqueId | |
|Platform | Windows|
|DetectionType | Hunting |
|ConnectorId | MicrosoftThreatProtection |
|DetectionId | d69ccf9a-4592-41db-a78f-f24108fea06e |
|DataTypes | DeviceLogonEvents |
|QueryFrequency |  |
|QueryPeriod |  |
|TriggerOperator |  |
|TriggerThreshold |  |
|DetectionSeverity |  |
|DetectionUrl | https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/General%20queries/insider-threat-detection-queries.yaml |
|IngestedDate | 2022-08-07 |

### KQL
```kql
// --------------------------------------------------------------------------------------------------------------------------- //
//
//Local Administrator
//
DeviceLogonEvents
| where IsLocalAdmin ==0
| where InitiatingProcessAccountName != "system"

```

## insider-threat-detection-queries

Intent:
- Use MTP capability to look for insider threat potential risk indicators
- Indicators would then serve as the building block for insider threat risk modeling in subsequent tools
Definition of Insider Threat:
"The potential for an individual who has or had authorized access to an organization's assets to use their access, either maliciously or unintentionally, to act in a way that could negatively affect the organization."
This collection of queries describes the different indicators that could be used to model and look for patterns suggesting an increased risk of an individual becoming a potential insider threat.
Note: no single indicator should be used as a lone determinant of insider threat activity, but should be part of an overall program to understand the increased risk to your organization's critical assets. This in turn is used to feed an investigation by a formal insider threat program to look at the context associated with the whole person to understand the implication of a set of indicators.

|Name | Value |
| --- | --- |
|Tactic | Exfiltration|
|TechniqueId | |
|Platform | Azure|
|DetectionType | Hunting |
|ConnectorId | MicrosoftThreatProtection |
|DetectionId | d69ccf9a-4592-41db-a78f-f24108fea06e |
|DataTypes | DeviceLogonEvents |
|QueryFrequency |  |
|QueryPeriod |  |
|TriggerOperator |  |
|TriggerThreshold |  |
|DetectionSeverity |  |
|DetectionUrl | https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/General%20queries/insider-threat-detection-queries.yaml |
|IngestedDate | 2022-08-07 |

### KQL
```kql
// --------------------------------------------------------------------------------------------------------------------------- //
//
//Local Administrator
//
DeviceLogonEvents
| where IsLocalAdmin ==0
| where InitiatingProcessAccountName != "system"

```

## insider-threat-detection-queries

Intent:
- Use MTP capability to look for insider threat potential risk indicators
- Indicators would then serve as the building block for insider threat risk modeling in subsequent tools
Definition of Insider Threat:
"The potential for an individual who has or had authorized access to an organization's assets to use their access, either maliciously or unintentionally, to act in a way that could negatively affect the organization."
This collection of queries describes the different indicators that could be used to model and look for patterns suggesting an increased risk of an individual becoming a potential insider threat.
Note: no single indicator should be used as a lone determinant of insider threat activity, but should be part of an overall program to understand the increased risk to your organization's critical assets. This in turn is used to feed an investigation by a formal insider threat program to look at the context associated with the whole person to understand the implication of a set of indicators.

|Name | Value |
| --- | --- |
|Tactic | Exfiltration|
|TechniqueId | |
|Platform | Windows|
|DetectionType | Hunting |
|ConnectorId | MicrosoftThreatProtection |
|DetectionId | d69ccf9a-4592-41db-a78f-f24108fea06e |
|DataTypes | DeviceLogonEvents |
|QueryFrequency |  |
|QueryPeriod |  |
|TriggerOperator |  |
|TriggerThreshold |  |
|DetectionSeverity |  |
|DetectionUrl | https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/General%20queries/insider-threat-detection-queries.yaml |
|IngestedDate | 2022-08-07 |

### KQL
```kql
// --------------------------------------------------------------------------------------------------------------------------- //
//
//Local Administrator
//
DeviceLogonEvents
| where IsLocalAdmin ==0
| where InitiatingProcessAccountName != "system"

```

## insider-threat-detection-queries (8)

Intent:
- Use MTP capability to look for insider threat potential risk indicators
- Indicators would then serve as the building block for insider threat risk modeling in subsequent tools
Definition of Insider Threat:
"The potential for an individual who has or had authorized access to an organization's assets to use their access, either maliciously or unintentionally, to act in a way that could negatively affect the organization."
This collection of queries describes the different indicators that could be used to model and look for patterns suggesting an increased risk of an individual becoming a potential insider threat.
Note: no single indicator should be used as a lone determinant of insider threat activity, but should be part of an overall program to understand the increased risk to your organization's critical assets. This in turn is used to feed an investigation by a formal insider threat program to look at the context associated with the whole person to understand the implication of a set of indicators.

|Name | Value |
| --- | --- |
|Tactic | Initial access|
|TechniqueId | |
|Platform | Azure|
|DetectionType | Hunting |
|ConnectorId | MicrosoftThreatProtection |
|DetectionId | 2eb45b94-4848-4e02-9679-ceb10b2445f2 |
|DataTypes | DeviceProcessEvents |
|QueryFrequency |  |
|QueryPeriod |  |
|TriggerOperator |  |
|TriggerThreshold |  |
|DetectionSeverity |  |
|DetectionUrl | https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/General%20queries/insider-threat-detection-queries%20(8).yaml |
|IngestedDate | 2022-08-07 |

### KQL
```kql
// --------------------------------------------------------------------------------------------------------------------------- //
//
//Usage of Source Control Management (SCM) Tool
//
//Update SCMTools with any additional SCM software specific to an organization.
let SCMTools = pack_array ("git.exe", "svn.exe", "hg.exe");
DeviceProcessEvents
| where FileName has_any (SCMTools) 
or ProcessCommandLine  has_any (SCMTools) 

```

## insider-threat-detection-queries (8)

Intent:
- Use MTP capability to look for insider threat potential risk indicators
- Indicators would then serve as the building block for insider threat risk modeling in subsequent tools
Definition of Insider Threat:
"The potential for an individual who has or had authorized access to an organization's assets to use their access, either maliciously or unintentionally, to act in a way that could negatively affect the organization."
This collection of queries describes the different indicators that could be used to model and look for patterns suggesting an increased risk of an individual becoming a potential insider threat.
Note: no single indicator should be used as a lone determinant of insider threat activity, but should be part of an overall program to understand the increased risk to your organization's critical assets. This in turn is used to feed an investigation by a formal insider threat program to look at the context associated with the whole person to understand the implication of a set of indicators.

|Name | Value |
| --- | --- |
|Tactic | Initial access|
|TechniqueId | |
|Platform | Windows|
|DetectionType | Hunting |
|ConnectorId | MicrosoftThreatProtection |
|DetectionId | 2eb45b94-4848-4e02-9679-ceb10b2445f2 |
|DataTypes | DeviceProcessEvents |
|QueryFrequency |  |
|QueryPeriod |  |
|TriggerOperator |  |
|TriggerThreshold |  |
|DetectionSeverity |  |
|DetectionUrl | https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/General%20queries/insider-threat-detection-queries%20(8).yaml |
|IngestedDate | 2022-08-07 |

### KQL
```kql
// --------------------------------------------------------------------------------------------------------------------------- //
//
//Usage of Source Control Management (SCM) Tool
//
//Update SCMTools with any additional SCM software specific to an organization.
let SCMTools = pack_array ("git.exe", "svn.exe", "hg.exe");
DeviceProcessEvents
| where FileName has_any (SCMTools) 
or ProcessCommandLine  has_any (SCMTools) 

```

## insider-threat-detection-queries (8)

Intent:
- Use MTP capability to look for insider threat potential risk indicators
- Indicators would then serve as the building block for insider threat risk modeling in subsequent tools
Definition of Insider Threat:
"The potential for an individual who has or had authorized access to an organization's assets to use their access, either maliciously or unintentionally, to act in a way that could negatively affect the organization."
This collection of queries describes the different indicators that could be used to model and look for patterns suggesting an increased risk of an individual becoming a potential insider threat.
Note: no single indicator should be used as a lone determinant of insider threat activity, but should be part of an overall program to understand the increased risk to your organization's critical assets. This in turn is used to feed an investigation by a formal insider threat program to look at the context associated with the whole person to understand the implication of a set of indicators.

|Name | Value |
| --- | --- |
|Tactic | Persistence|
|TechniqueId | |
|Platform | Azure|
|DetectionType | Hunting |
|ConnectorId | MicrosoftThreatProtection |
|DetectionId | 2eb45b94-4848-4e02-9679-ceb10b2445f2 |
|DataTypes | DeviceProcessEvents |
|QueryFrequency |  |
|QueryPeriod |  |
|TriggerOperator |  |
|TriggerThreshold |  |
|DetectionSeverity |  |
|DetectionUrl | https://github.com/Azure/Azure-Sentinel/blob/master/Hunting%20Queries/Microsoft%20365%20Defender/General%20queries/insider-threat-detection-queries%20(8).yaml |
|IngestedDate | 2022-08-07 |

### KQL
```kql
// --------------------------------------------------------------------------------------------------------------------------- //
//
//Usage of Source Control Management (SCM) Tool
//
//Update SCMTools with any additional SCM software specific to an organization.
let SCMTools = pack_array ("git.exe", "svn.exe", "hg.exe");
DeviceProcessEvents
| where FileName has_any (SCMTools) 
or ProcessCommandLine  has_any (SCMTools) 

```
